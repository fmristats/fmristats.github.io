

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Subject analysis: Inference at a single coordinate &mdash; fmristats 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Population inference: Create a sample for further analysis" href="population-inference-preliminaries.html" />
    <link rel="prev" title="Subject analysis: Prune a statistics field from non-brain areas" href="subject-remove-non-brain-areas.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> fmristats
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting to know fmristats</a></li>
<li class="toctree-l1"><a class="reference internal" href="study-interface.html">Analysing multiple subjects</a></li>
<li class="toctree-l1"><a class="reference internal" href="subject-remove-non-brain-areas.html">Subject analysis: Prune a statistics field from non-brain areas</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Subject analysis: Inference at a single coordinate</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-the-model">Create the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-information">Query information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fit-the-model">Fit the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#select-the-highest-peak-in-the-t-field">Select the highest peak in the t-field</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-scatter-plot-of-fmri-data-around-a-coordinate">Create a scatter plot of FMRI data around a coordinate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fit-different-models-to-the-data-at-the-coordinate">Fit different models to the data at the coordinate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model-1-fully-saturated-and-nested-task-block-design">Model 1: fully saturated and nested task/block design</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-2-linear-in-time-and-task">Model 2: linear in time and task</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-3-b-spline-model-with-12-degrees-of-freedom">Model 3: b-spline model with 12 degrees of freedom</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#plot-the-fitted-regression-surfaces">Plot the fitted regression surfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#formal-testing">Formal testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#effect-strength">Effect strength</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-statistic">Test statistic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#p-values">P-Values</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="population-inference-preliminaries.html">Population inference: Create a sample for further analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="population-inference-confirmative.html">Population inference: Confirmation study</a></li>
<li class="toctree-l1"><a class="reference internal" href="population-inference-explorative.html">Population inference: Exploratory study</a></li>
<li class="toctree-l1"><a class="reference internal" href="population-inference-covariates.html">Population inference: How to adjust for covariates</a></li>
<li class="toctree-l1"><a class="reference internal" href="thresholding.html">Thresholding</a></li>
<li class="toctree-l1"><a class="reference internal" href="run-on-server.html">Run the analysis on a server</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes.html">Some notes on speed</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../new.html">What is new</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fmristats</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Subject analysis: Inference at a single coordinate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/subject-inference-at-one-point.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="subject-analysis-inference-at-a-single-coordinate">
<span id="subject-inference"></span><h1>Subject analysis: Inference at a single coordinate<a class="headerlink" href="#subject-analysis-inference-at-a-single-coordinate" title="Permalink to this headline">¶</a></h1>
<p>A signal model has been fitted to FMRI session data:</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fmrifit</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">stimulus</span><span class="o">-</span><span class="n">block</span> <span class="n">letter</span> <span class="o">--</span><span class="n">window</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">2</span>

<span class="n">fsl4prune</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="nb">id</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The Python interface will usually give you some further flexibility.</p>
<div class="section" id="create-the-model">
<h2>Create the model<a class="headerlink" href="#create-the-model" title="Permalink to this headline">¶</a></h2>
<p>Load the FMRI data, the head movements, and the population map from disk:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fmristats</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1"># the FMRI data</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">path_to_session</span><span class="p">)</span>

<span class="c1"># the fitted head movements (reference maps)</span>
<span class="n">reference_maps</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">path_to_reference_maps</span><span class="p">)</span>

<span class="c1"># smooth out the movement estimates a little</span>
<span class="n">reference_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">reference_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">reference_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># load a diffeomorphism from disk</span>
<span class="n">population_map</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">path_to_population_map</span><span class="p">)</span>
</pre></div>
</div>
<p>Create the model: Set the stimulus design in the model, set the
MRI-observations, and set the only(!) hyperparameter of the
MB-estimator, namely the curvature of the spatial weighting kernel.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SignalModel</span><span class="p">(</span>
    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
    <span class="n">reference_maps</span><span class="o">=</span><span class="n">reference_maps</span><span class="p">,</span>
    <span class="n">population_map</span><span class="o">=</span><span class="n">population_map</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">set_stimulus_design</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="s1">&#39;letter&#39;</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="s1">&#39;control&#39;</span><span class="p">,</span>
        <span class="n">offset</span><span class="o">=</span><span class="mf">5.242</span><span class="p">,</span>
        <span class="n">preset</span><span class="o">=</span><span class="mf">1.42</span><span class="p">)</span>

<span class="c1"># discard the data of the first four scan cycles</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">burn_in</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># set the width of the Gaussian kernel that is used for spatial</span>
<span class="c1"># weighting</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_hyperparameters</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AGB300</span><span class="o">-</span><span class="mi">0002</span><span class="o">-</span><span class="n">WGT</span><span class="p">:</span>
            <span class="n">Number</span> <span class="n">of</span> <span class="n">within</span> <span class="n">brain</span> <span class="n">observations</span><span class="p">:</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">760</span><span class="p">,</span><span class="mi">279</span>
            <span class="n">Number</span> <span class="n">of</span>    <span class="n">non</span> <span class="n">brain</span> <span class="n">observations</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span><span class="mi">502</span><span class="p">,</span><span class="mi">121</span>
            <span class="n">Intercept</span> <span class="n">field</span> <span class="n">refers</span> <span class="n">to</span> <span class="n">time</span><span class="p">:</span>          <span class="mf">165.35</span> <span class="n">s</span>
</pre></div>
</div>
<p>Save the model to disk (if you like):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;subject.model&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="query-information">
<h2>Query information<a class="headerlink" href="#query-information" title="Permalink to this headline">¶</a></h2>
<p>Get some information about the FMRI data:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reference_maps</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Resolution</span> <span class="p">(</span><span class="n">left</span> <span class="n">to</span> <span class="n">right</span><span class="p">):</span>          <span class="mf">3.00</span> <span class="n">mm</span>
<span class="n">Resolution</span> <span class="p">(</span><span class="n">posterior</span> <span class="n">to</span> <span class="n">anterior</span><span class="p">):</span>  <span class="mf">3.00</span> <span class="n">mm</span>
<span class="n">Resolution</span> <span class="p">(</span><span class="n">inferior</span> <span class="n">to</span> <span class="n">superior</span><span class="p">):</span>   <span class="mf">4.60</span> <span class="n">mm</span>
<span class="n">Diagonal</span> <span class="n">of</span> <span class="n">one</span> <span class="n">voxel</span><span class="p">:</span>               <span class="mf">6.26</span> <span class="n">mm</span>
<span class="n">Volume</span> <span class="n">of</span> <span class="n">one</span> <span class="n">voxel</span><span class="p">:</span>                <span class="mf">41.40</span> <span class="n">mm</span><span class="o">^</span><span class="mi">3</span>
<span class="n">Aspect</span> <span class="mi">0</span> <span class="n">on</span> <span class="mi">1</span><span class="p">:</span>                       <span class="mf">1.00</span>
<span class="n">Aspect</span> <span class="mi">0</span> <span class="n">on</span> <span class="mi">2</span><span class="p">:</span>                       <span class="mf">0.65</span>
<span class="n">Aspect</span> <span class="mi">1</span> <span class="n">on</span> <span class="mi">2</span><span class="p">:</span>                       <span class="mf">0.65</span>

<span class="n">EPI</span> <span class="n">code</span><span class="p">:</span> <span class="mi">3</span>

<span class="n">Scans</span><span class="p">:</span>        <span class="mi">6900</span>
<span class="n">Valid</span><span class="p">:</span>        <span class="mi">6900</span>
<span class="n">Outlying</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span><span class="p">)</span>

<span class="n">Scan</span> <span class="n">cycles</span><span class="p">:</span>   <span class="mi">230</span>
<span class="n">Valid</span><span class="p">:</span>         <span class="mi">230</span>
<span class="n">Outlying</span><span class="p">:</span>        <span class="mi">0</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">%</span><span class="p">)</span>
</pre></div>
</div>
<p>Get some information about the model:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Hyperparameters</span><span class="p">:</span>
    <span class="n">Scale</span> <span class="nb">type</span><span class="p">:</span>         <span class="nb">max</span>
    <span class="n">Factor</span><span class="p">:</span>            <span class="mf">3.00</span>

<span class="n">Resulting</span> <span class="ow">in</span><span class="p">:</span>
    <span class="n">Mass</span><span class="p">:</span>            <span class="mf">0.9973</span>
    <span class="n">Scale</span><span class="p">:</span>             <span class="mf">2.30</span> <span class="n">mm</span>
    <span class="n">FWHM</span><span class="p">:</span>              <span class="mf">5.42</span> <span class="n">mm</span>
    <span class="n">Radius</span><span class="p">:</span>            <span class="mf">6.90</span> <span class="n">mm</span>
    <span class="n">Diagonal</span><span class="p">:</span>         <span class="mf">13.80</span> <span class="n">mm</span>
</pre></div>
</div>
</div>
<div class="section" id="fit-the-model">
<h2>Fit the model<a class="headerlink" href="#fit-the-model" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>Save the result to disk (if you like):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;subject.fit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Prune the statistics field from non-brain areas. You are expected to do
his manually, as fmristats will usually avoid deleting data:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="select-the-highest-peak-in-the-t-field">
<h2>Select the highest peak in the t-field<a class="headerlink" href="#select-the-highest-peak-in-the-t-field" title="Permalink to this headline">¶</a></h2>
<p>Select the highest peak in the t-statistics field:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tstatistics</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;tstatistic&#39;</span><span class="p">)</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">tstatistics</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">tstatistics</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">coordinate</span> <span class="o">=</span> <span class="n">tstatistics</span><span class="o">.</span><span class="n">apply_to_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    index in the image :          </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">    coordinate in standard space: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">    hight of the peak:            </span><span class="si">{:.2f}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">coordinate</span><span class="p">,</span> <span class="n">tstatistics</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">image</span> <span class="p">:</span>          <span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">coordinate</span> <span class="ow">in</span> <span class="n">standard</span> <span class="n">space</span><span class="p">:</span> <span class="p">[</span> <span class="mf">12.</span> <span class="o">-</span><span class="mf">80.</span>   <span class="mf">8.</span><span class="p">]</span>
<span class="n">hight</span> <span class="n">of</span> <span class="n">the</span> <span class="n">peak</span><span class="p">:</span>            <span class="mf">7.64</span>
</pre></div>
</div>
<p>Plot the respective horizontal slice that goes through the above peak:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fmristats.plot</span> <span class="k">import</span> <span class="n">picture</span>

<span class="n">picture</span><span class="p">(</span><span class="n">tstatistics</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,[</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">mark_peak</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/subject-inference-at-one-point_figure13_1.png"><img alt="../_images/subject-inference-at-one-point_figure13_1.png" src="../_images/subject-inference-at-one-point_figure13_1.png" style="width: 15cm;" /></a>
<p>Find out the name of standard space, so that you may use a query tool to
find the region to which this coordinate belongs:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">population_map</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Population</span> <span class="nb">map</span>
<span class="o">--------------</span>
<span class="n">diffeomorphism</span><span class="p">:</span> <span class="n">ants</span>
<span class="n">vb</span><span class="p">:</span>             <span class="n">mni152</span>
<span class="n">nb</span><span class="p">:</span>             <span class="n">AGB300</span><span class="o">-</span><span class="mi">0002</span><span class="o">-</span><span class="n">WGT</span><span class="o">-</span><span class="mi">42</span>
<span class="n">vb_background</span><span class="p">:</span>  <span class="n">mni152</span><span class="o">-</span><span class="n">t1</span>
<span class="n">nb_background</span><span class="p">:</span>  <span class="o">--</span>
<span class="n">vb_estimate</span><span class="p">:</span>    <span class="n">vb_estimate_ants</span>
<span class="n">nb_estimate</span><span class="p">:</span>    <span class="n">nb_estimate_ants</span>
<span class="n">vb_mask</span><span class="p">:</span>        <span class="o">--</span>
<span class="n">nb_mask</span><span class="p">:</span>        <span class="o">--</span>
<span class="n">vb_ati</span><span class="p">:</span>         <span class="o">--</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">atlasquery</span></code> tool from the FSL project to see to which
structure these coordinates belong:</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atlasquery</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;MNI Structural Atlas&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span><span class="mi">8</span>
<span class="n">MNI</span> <span class="n">Structural</span> <span class="n">Atlas</span>
<span class="mi">40</span><span class="o">%</span> <span class="n">Occipital</span> <span class="n">Lobe</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-scatter-plot-of-fmri-data-around-a-coordinate">
<h2>Create a scatter plot of FMRI data around a coordinate<a class="headerlink" href="#create-a-scatter-plot-of-fmri-data-around-a-coordinate" title="Permalink to this headline">¶</a></h2>
<p>Extract the data at the index:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data_at_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">signal</span>        <span class="n">time</span>  <span class="n">task</span>  <span class="n">block</span>  <span class="n">cycle</span>  <span class="nb">slice</span>    <span class="n">weight</span>
<span class="mi">0</span>   <span class="mf">958.0</span> <span class="o">-</span><span class="mf">154.664538</span>   <span class="mf">0.0</span>    <span class="mf">0.0</span>    <span class="mf">7.0</span>   <span class="mf">11.0</span>  <span class="mf">0.020139</span>
<span class="mi">1</span>   <span class="mf">986.0</span> <span class="o">-</span><span class="mf">154.664538</span>   <span class="mf">0.0</span>    <span class="mf">0.0</span>    <span class="mf">7.0</span>   <span class="mf">11.0</span>  <span class="mf">0.048931</span>
<span class="mi">2</span>  <span class="mf">1031.0</span> <span class="o">-</span><span class="mf">154.664538</span>   <span class="mf">0.0</span>    <span class="mf">0.0</span>    <span class="mf">7.0</span>   <span class="mf">11.0</span>  <span class="mf">0.021690</span>
<span class="mi">3</span>  <span class="mf">1073.0</span> <span class="o">-</span><span class="mf">154.664538</span>   <span class="mf">0.0</span>    <span class="mf">0.0</span>    <span class="mf">7.0</span>   <span class="mf">11.0</span>  <span class="mf">0.069630</span>
<span class="mi">4</span>  <span class="mf">1108.0</span> <span class="o">-</span><span class="mf">154.664538</span>   <span class="mf">0.0</span>    <span class="mf">0.0</span>    <span class="mf">7.0</span>   <span class="mf">11.0</span>  <span class="mf">0.169175</span>
</pre></div>
</div>
<p>Some information about the number of blocks and block labels of the
stimulus design:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Task labels</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Task labels:               </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>

<span class="c1"># Block labels and number of blocks</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Block labels:              </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of blocks per task: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>

<span class="c1"># Scan cycles within task blocks and their total number</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of scan cycles:     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cycle</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Task</span> <span class="n">labels</span><span class="p">:</span>               <span class="p">[</span><span class="mf">0.</span> <span class="mf">1.</span><span class="p">]</span>
<span class="n">Block</span> <span class="n">labels</span><span class="p">:</span>              <span class="p">[</span><span class="mf">0.</span> <span class="mf">1.</span> <span class="mf">2.</span> <span class="mf">3.</span> <span class="mf">4.</span> <span class="mf">5.</span> <span class="mf">6.</span> <span class="mf">7.</span><span class="p">]</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">blocks</span> <span class="n">per</span> <span class="n">task</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">scan</span> <span class="n">cycles</span><span class="p">:</span>     <span class="mi">94</span>
</pre></div>
</div>
<p>For visualisation, define a suitable scale for the scatters in relation
to their distance to <span class="math notranslate nohighlight">\(x\)</span>, and order the MRI-observations by time
of acquisition:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">elem</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">weight</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">w</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">w</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">w</span> <span class="o">=</span> <span class="o">.</span><span class="mi">87</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="mf">1.069</span><span class="p">)</span>
</pre></div>
</div>
<p>Create the scatter plot (click the image to enlarge):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sb</span>
<span class="n">sb</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn-colorblind&#39;</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">signal</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MR Signal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">pt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/subject-inference-at-one-point_figure18_1.png"><img alt="../_images/subject-inference-at-one-point_figure18_1.png" src="../_images/subject-inference-at-one-point_figure18_1.png" style="width: 15cm;" /></a>
</div>
<div class="section" id="fit-different-models-to-the-data-at-the-coordinate">
<h2>Fit different models to the data at the coordinate<a class="headerlink" href="#fit-different-models-to-the-data-at-the-coordinate" title="Permalink to this headline">¶</a></h2>
<p>fmristats is very flexible when it comes to defining models for your
FMRI data. In deed, you have the full power of <a class="reference external" href="https://patsy.readthedocs.io/en/latest/">patsy</a> at your disposal.</p>
<div class="section" id="model-1-fully-saturated-and-nested-task-block-design">
<h3>Model 1: fully saturated and nested task/block design<a class="headerlink" href="#model-1-fully-saturated-and-nested-task-block-design" title="Permalink to this headline">¶</a></h3>
<p>This is a very parsimonious and robust model for FMRI and it is the
default as well as the generally recommended model when using fmristats.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fit1</span><span class="p">,</span> <span class="n">model1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_at_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
    <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;signal~C(task)/C(block, Sum)&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit1</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">predict1</span> <span class="o">=</span> <span class="n">fit1</span><span class="o">.</span><span class="n">predict</span><span class="p">()[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="model-2-linear-in-time-and-task">
<h3>Model 2: linear in time and task<a class="headerlink" href="#model-2-linear-in-time-and-task" title="Permalink to this headline">¶</a></h3>
<p>This appears to be a common model. Note, however, that the model is
unable to account for nested effects which typically will increase the
residual mean squared error of the fit, thus, reducing your power.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fit2</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_at_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
    <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;signal~time+C(task)&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit2</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">predict2</span> <span class="o">=</span> <span class="n">fit2</span><span class="o">.</span><span class="n">predict</span><span class="p">()[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="model-3-b-spline-model-with-12-degrees-of-freedom">
<h3>Model 3: b-spline model with 12 degrees of freedom<a class="headerlink" href="#model-3-b-spline-model-with-12-degrees-of-freedom" title="Permalink to this headline">¶</a></h3>
<p>This model is insanely flexible and may be used as an example to show
the effects of over-fitting.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fit3</span><span class="p">,</span> <span class="n">model3</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_at_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span>
    <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;signal~bs(time,df=12)+C(task)&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit3</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">predict3</span> <span class="o">=</span> <span class="n">fit3</span><span class="o">.</span><span class="n">predict</span><span class="p">()[</span><span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plot-the-fitted-regression-surfaces">
<h2>Plot the fitted regression surfaces<a class="headerlink" href="#plot-the-fitted-regression-surfaces" title="Permalink to this headline">¶</a></h2>
<p>Plot of the fitted regression surfaces (click image to enlarge):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">current_palette</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">current_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">current_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">current_palette</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">pt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict1</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c1</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;task/block&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict2</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c2</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;task+time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict3</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c3</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;task+bs(time,df=12)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Expected Signal as Predicted by Model&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">pt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1">#Add block labels:</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span><span class="s1">&#39;y3&#39;</span><span class="p">]]</span>
<span class="n">positions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">positions</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="n">positions</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">positions</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">positions</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">positions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;task&#39;</span><span class="p">,</span><span class="s1">&#39;block&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">positions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">positions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">fit1</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">fit1</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">task</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$B_</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">block</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$A_</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">block</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">time</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="o">+.</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/subject-inference-at-one-point_figure22_1.png"><img alt="../_images/subject-inference-at-one-point_figure22_1.png" src="../_images/subject-inference-at-one-point_figure22_1.png" style="width: 15cm;" /></a>
<p>You may also combine the two plots (click image to enlarge):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">figw</span> <span class="o">=</span> <span class="mf">11.842</span>
<span class="n">figh</span> <span class="o">=</span> <span class="mf">5.442</span>

<span class="n">figw</span> <span class="o">=</span> <span class="mf">11.842</span>
<span class="n">figh</span> <span class="o">=</span> <span class="mf">7.442</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">fit1</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">fit1</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span>

<span class="n">left</span>       <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">right</span>      <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">maintop</span>    <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">mainbottom</span> <span class="o">=</span> <span class="mf">0.38</span>
<span class="n">meantop</span>    <span class="o">=</span> <span class="mf">0.36</span>
<span class="n">meanbottom</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">pt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figw</span><span class="p">,</span><span class="n">figh</span><span class="p">))</span>

<span class="c1"># The top figure:</span>
<span class="n">main_ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span><span class="n">mainbottom</span><span class="p">,</span><span class="n">right</span><span class="o">-</span><span class="n">left</span><span class="p">,</span><span class="n">maintop</span><span class="o">-</span><span class="n">mainbottom</span><span class="p">])</span>
<span class="n">mean_ax</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span><span class="n">meanbottom</span><span class="p">,</span><span class="n">right</span><span class="o">-</span><span class="n">left</span><span class="p">,</span><span class="n">meantop</span><span class="o">-</span><span class="n">meanbottom</span><span class="p">],</span>
    <span class="n">sharex</span><span class="o">=</span><span class="n">main_ax</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">signal</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed MR Signal&#39;</span><span class="p">)</span>
<span class="n">main_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict1</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c1</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;task/block&#39;</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">main_ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sb</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="c1"># The bottom figure:</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="c1">#, label=&#39;mean signal in A&#39;)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="c1">#, label=&#39;mean signal in B&#39;)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict1</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c1</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;task/block [fully saturated]&#39;</span><span class="p">)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict2</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c2</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;task+time [linear in time]&#39;</span><span class="p">)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="n">predict3</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c3</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;task+bs(time,df=12) [high temporal flexibility]&#39;</span><span class="p">)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Estimated Mean</span><span class="se">\n</span><span class="s1">by Model&#39;</span><span class="p">)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">mean_ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.43</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">#Add block labels:</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">task</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$B_</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">block</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$A_</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">block</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mean_ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">time</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="o">+</span><span class="mf">1.8</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="c1"># Save the plot to disk:</span>
<span class="n">pt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">scatter_plot</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/subject-inference-at-one-point_figure24_1.png"><img alt="../_images/subject-inference-at-one-point_figure24_1.png" src="../_images/subject-inference-at-one-point_figure24_1.png" style="width: 15cm;" /></a>
</div>
<div class="section" id="formal-testing">
<h2>Formal testing<a class="headerlink" href="#formal-testing" title="Permalink to this headline">¶</a></h2>
<p>Test for non-zero task related effects.</p>
<div class="section" id="effect-strength">
<h3>Effect strength<a class="headerlink" href="#effect-strength" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit1</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit2</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">14.526104774712344</span>
<span class="mf">14.057526450085476</span>
<span class="mf">13.339944081795096</span>
</pre></div>
</div>
</div>
<div class="section" id="test-statistic">
<h3>Test statistic<a class="headerlink" href="#test-statistic" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit1</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit2</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">7.460551272843621</span>
<span class="mf">7.112567149684203</span>
<span class="mf">4.4370014597571314</span>
</pre></div>
</div>
</div>
<div class="section" id="p-values">
<h3>P-Values<a class="headerlink" href="#p-values" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit1</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit2</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.0980615941762318e-13</span>
<span class="mf">1.3918174784009391e-12</span>
<span class="mf">9.422750022149465e-06</span>
</pre></div>
</div>
<p>Test whether time is an influential factor in model 2 at this
coordinate:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit2</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.08344187219441945</span>
</pre></div>
</div>
<p>Test whether time is an influential factor in model 2 at this
coordinate:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fit3</span><span class="o">.</span><span class="n">f_test</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
</pre></div>
</div>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">F</span> <span class="n">test</span><span class="p">:</span> <span class="n">F</span><span class="o">=</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.9721569</span><span class="p">]]),</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.022923767880701367</span><span class="p">,</span>
<span class="n">df_denom</span><span class="o">=</span><span class="mi">3273</span><span class="p">,</span> <span class="n">df_num</span><span class="o">=</span><span class="mi">12</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>It can safely be argued that time has no significant influence, and that
the data suggest no temporal signal fluctuation at <span class="math notranslate nohighlight">\(x\)</span>. Note that
even if there were, the non-parametric time dimension of model 1 would
still be able to handle it.</p>
<p>All p-values need to be adjusted for multiple testing.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="population-inference-preliminaries.html" class="btn btn-neutral float-right" title="Population inference: Create a sample for further analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="subject-remove-non-brain-areas.html" class="btn btn-neutral" title="Subject analysis: Prune a statistics field from non-brain areas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Thomas W. D. Möbius

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.1.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>